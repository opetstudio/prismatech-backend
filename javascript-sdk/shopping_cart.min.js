"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,r=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(a=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _MaterialUI=MaterialUI,Button=_MaterialUI.Button,Card=_MaterialUI.Card,CardActions=_MaterialUI.CardActions,CardContent=_MaterialUI.CardContent,CardMedia=_MaterialUI.CardMedia,CssBaseline=_MaterialUI.CssBaseline,Grid=_MaterialUI.Grid,Typography=_MaterialUI.Typography,makeStyles=_MaterialUI.makeStyles,Container=_MaterialUI.Container,IconButton=_MaterialUI.IconButton,SkipNextIcon=_MaterialUI.SkipNextIcon,SkipPreviousIcon=_MaterialUI.SkipPreviousIcon,PlayArrowIcon=_MaterialUI.PlayArrowIcon,useTheme=_MaterialUI.useTheme,TextField=_MaterialUI.TextField,FormControlLabel=_MaterialUI.FormControlLabel,Checkbox=_MaterialUI.Checkbox,Avatar=_MaterialUI.Avatar,ListItem=_MaterialUI.ListItem,ListItemAvatar=_MaterialUI.ListItemAvatar,ListItemText=_MaterialUI.ListItemText,ListItemSecondaryAction=_MaterialUI.ListItemSecondaryAction,List=_MaterialUI.List,Divider=_MaterialUI.Divider,FormControl=_MaterialUI.FormControl,InputLabel=_MaterialUI.InputLabel,Select=_MaterialUI.Select,MenuItem=_MaterialUI.MenuItem,FormHelperText=_MaterialUI.FormHelperText,CircularProgress=_MaterialUI.CircularProgress,Switch=_MaterialUI.Switch,backendBaseUrl=TOKOONLINE_BASEURL,useStyles=makeStyles((function(e){return{root:{margin:8,backgroundColor:e.palette.background.paper,overflow:"hidden"},margin:{margin:e.spacing(1)}}})),totalAmount=0;function App(){localStorage.getItem(TOKOONLINE_TOKOID)||localStorage.setItem(TOKOONLINE_TOKOID,""+(new Date).getTime());var e=useStyles(),t=(useTheme(),React.useState({error:null,listData:null,pageCount:0,pageIndex:0,pageSize:0,count:0,reload:0,isNeedShipping:null,isRequest:!0})),n=_slicedToArray(t,2),a=n[0],r=n[1],i=React.useState({error:null,isRequest:!1}),o=_slicedToArray(i,2),l=(o[0],o[1]),c=React.useState({payload:{},error:null,isRequest:!1,detailData:{}}),s=_slicedToArray(c,2),u=s[0],d=s[1],p=React.useState({error:null,isRequest:!1}),m=_slicedToArray(p,2),_=(m[0],m[1]),g=React.useState({error:null,detailData:null,isRequest:!1}),h=_slicedToArray(g,2),y=h[0],f=h[1],I=React.useState(0),R=_slicedToArray(I,2),v=R[0],T=R[1],E=React.useState([]),O=_slicedToArray(E,2),b=O[0],S=O[1],C=React.useState(null),k=_slicedToArray(C,2),N=k[0],A=k[1],M=React.useState([]),x=_slicedToArray(M,2),L=x[0],U=x[1],P=React.useState(null),j=_slicedToArray(P,2),K=j[0],D=j[1],w=React.useState(null),q=_slicedToArray(w,2),F=q[0],B=q[1],G=React.useState([]),J=_slicedToArray(G,2),z=J[0],H=J[1],W=React.useState([]),Y=_slicedToArray(W,2),V=Y[0],Q=Y[1],X=React.useState(null),Z=_slicedToArray(X,2),$=Z[0],ee=Z[1],te=React.useState(0),ne=_slicedToArray(te,2),ae=ne[0],re=ne[1],ie=(a.count,a.pageCount,a.listData),oe=a.pageIndex,le=a.pageSize,ce=a.reload,se=React.useState({originProv:null,originCity:null,originSubcity:null}),ue=_slicedToArray(se,2),de=ue[0],pe=ue[1],me=(de.originProv,de.originCity,de.originSubcity,React.useCallback((function(e){e.pageSize,e.pageIndex;var t='query{\n      getAllTokoCartsBySessionId(session_id: "'+localStorage.getItem(TOKOONLINE_TOKOID)+'", page_size: 10, page_index: 0){\n        error,\n        count,\n        page_count,\n        status,\n        is_need_shipping,\n        list_data{\n          _id,\n          product_id{\n            _id,\n            code,\n            price,\n            name,\n            description,\n            image_id{\n              _id,\n              filename,\n              file_type\n            },\n            weight\n          },\n          toko_id{\n            name,\n            province,\n            city,\n            subcity\n          },\n          count,\n          amount\n        }\n      }\n    }',n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})};fetch(backendBaseUrl+"/graphql",n).then((function(e){return e.json()})).then((function(e){return console.log("response getAllTokoCartsBySessionId===>",e),e.data.getAllTokoCartsBySessionId})).then((function(e){r({listData:e.list_data,pageCount:e.page_count,isNeedShipping:e.is_need_shipping,count:e.count,isRequest:!1}),re((e.list_data||[]).map((function(e){return parseFloat(e.product_id.weight)*e.count})).reduce((function(e,t){return parseFloat(e)+parseFloat(t)}),0)),0!==e.list_data.length&&pe({originProv:e.list_data[0].toko_id.province,originCity:e.list_data[0].toko_id.city,originSubcity:e.list_data[0].toko_id.subcity})}))}),[]));React.useEffect((function(){me({pageSize:le,pageIndex:oe})}),[me,oe,le,ce]);var _e=React.useCallback((function(){var e='query{\n      getDetailTokoPoBySessionId(session_id: "'+localStorage.getItem(TOKOONLINE_TOKOID)+'"){\n          error,\n          status,\n          data_detail{\n            _id,\n            email,\n            full_name,\n            invoice_code,\n            phone_number,\n            shipping_address,\n            total_amount,\n            total_product_amount,\n            shipping_amount,\n            shipping_province,\n            shipping_city,\n            shipping_subcity,\n            shipping_currier,\n            shipping_postal_code\n          }\n        }\n      }',t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})};fetch(backendBaseUrl+"/graphql",t).then((function(e){return e.json()})).then((function(e){return e.data.getDetailTokoPoBySessionId})).then((function(e){e&&(f({detailData:e.data_detail,isRequest:!1,error:null}),d({payload:{full_name:(e.data_detail||{}).full_name,email:(e.data_detail||{}).email,phone_number:(e.data_detail||{}).phone_number,shipping_address:(e.data_detail||{}).shipping_address,shipping_amount:(e.data_detail||{}).shipping_amount,shipping_province:(e.data_detail||{}).shipping_province,shipping_city:(e.data_detail||{}).shipping_city,shipping_subcity:(e.data_detail||{}).shipping_subcity,shipping_currier:(e.data_detail||{}).shipping_currier,shipping_postal_code:(e.data_detail||{}).shipping_postal_code}}))}))}),[]);React.useEffect((function(){_e()}),[_e]);var ge=React.useCallback((function(){fetch("https://market-studio.plink.co.id/api/v1/fetchdata-province",{method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}}).then((function(e){return e.json()})).then((function(e){200===e.rajaongkir.status.code&&S(e.rajaongkir.results)}),(function(e){console.log("error1 : "+JSON.stringify(e))}))}),[]);React.useEffect((function(){ge()}),[ge]);var he=React.useState(null),ye=_slicedToArray(he,2),fe=ye[0],Ie=ye[1],Re=function(e){if(null!==F&&0!=ae){ee(e);var t={origin:de.originSubcity,originType:"subdistrict",destination:F.subdistrict_id,destinationType:"subdistrict",weight:1e3*ae,courier:e};console.log("countDistanceRequest "+JSON.stringify(t)),fetch("https://market-studio.plink.co.id/api/v1/fetchdata-cost",{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify(t)}).then((function(e){return e.json()})).then((function(e){console.log("result"+JSON.stringify(e)),H(e.rajaongkir.results[0].costs)}),(function(e){console.log(JSON.stringify(e))}))}};React.useEffect((function(){"Y"!=a.isNeedShipping||""==$||Re()}),[ae]);var ve=function(t){var n=t.productImage,a=t.productName,i=t.productPrice,o=t.index,c=(t.amount,t.count),s=t.productId;return React.createElement("div",{key:o},React.createElement(ListItem,{button:!0},React.createElement(ListItemAvatar,null,React.createElement(Avatar,{alt:"Avatar nÂ°"+(o+1),src:backendBaseUrl+"/renderfile/"+n.filename+"."+n.file_type})),React.createElement(ListItemText,{primary:a,secondary:React.createElement(React.Fragment,null,React.createElement(Button,{size:"small",onClick:function(){return function(e){var t=e.productId,n='mutation{removeFromCart(  toko_id: "'+TOKOONLINE_TOKOID+'", device_id: "xxxx", product_id: "'+t+'", session_id: "'+localStorage.getItem(TOKOONLINE_TOKOID)+'"){status,error,detail_data{_id,product_id{_id,name,\n              code,\n              price,\n              description,\n              image_id{\n                _id,\n                filename,\n                file_type\n              }\n            }\n            count,\n            device_id,\n            session_id,\n            toko_id{\n              slug\n            }\n          }\n        }\n      }',a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n})};fetch(backendBaseUrl+"/graphql",a).then((function(e){return e.json()})).then((function(e){return console.log("response===>",e),e.errors?alert(JSON.stringify(e.errors)):e.data.removeFromCart})).then((function(e){e&&(_({error:e.error,isRequest:!1}),e.error?alert(e.error):r({reload:ce+1}))}))}({productId:s})}},"-"),"  "+c+"  ",React.createElement(Button,{size:"small",onClick:function(){return function(e){var t=e.productId,n='mutation{addToCart( toko_id: "'+TOKOONLINE_TOKOID+'", device_id: "xxxx", product_id: "'+t+'", session_id: "'+localStorage.getItem(TOKOONLINE_TOKOID)+'"){status,error,detail_data{_id,product_id{_id,name,\n                          code,\n                          price,\n                          description,\n                          image_id{\n                            _id,\n                            filename,\n                            file_type\n                          }\n                        }\n                        count,\n                        amount,\n                        device_id,\n                        session_id,\n                        toko_id{\n                          slug\n                        }\n                      }\n                    }\n                    }',a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n})};fetch(backendBaseUrl+"/graphql",a).then((function(e){return e.json()})).then((function(e){return console.log("response===>",e),e.errors?alert(JSON.stringify(e.errors)):e.data.addToCart})).then((function(e){e&&(l({error:e.error,isRequest:!1}),e.error?alert(e.error):r({reload:ce+1}))}))}({productId:s})}},"+"))}),React.createElement(ListItemSecondaryAction,null,React.createElement(Typography,{component:"span",variant:"caption",className:e.inline,color:"textPrimary"},Te(i)))),React.createElement(Divider,{component:"li"}))},Te=function(e){var t=e.toString().split("").reverse().join("").match(/\d{1,3}/g);return"Rp. "+(t=t.join(".").split("").reverse().join(""))},Ee=((y.detailData||{}).full_name,function(e){var t,n=e.name,a=e.label,r=e.value,i=(e.defaultValue,e.option),o=e.row;return React.createElement(Grid,(_defineProperty(t={item:!0},"item",!0),_defineProperty(t,"xs",12),_defineProperty(t,"md","area"==i?12:6),t),React.createElement(TextField,{id:n,label:a,fullWidth:!0,defaultValue:r,value:r,multiline:!0,rows:o,InputLabelProps:{shrink:!0},onChange:function(e){return d({payload:Object.assign({},u.payload,_defineProperty({},n,e.target.value))})}}))});return React.createElement("div",null,React.createElement(CssBaseline,null),a.isRequest?React.createElement(Grid,{container:!0,spacing:0,direction:"column",alignItems:"center",justify:"center",style:{minHeight:"100vh"}},React.createElement(CircularProgress,null)):React.createElement(Grid,{container:!0},React.createElement(Grid,{item:!0,xs:12,sm:12,md:12,lg:6},React.createElement(Card,{className:e.root},React.createElement(CardContent,null,React.createElement(List,null,(ie||[]).map((function(e,t){var n=e.amount,a=e.count,r=e.product_id._id,i=e.product_id.name,o=e.product_id.price,l=(e.product_id||{}).image_id||{};return ve({amount:n,count:a,productName:i,productPrice:o,productImage:l,index:t,productId:r})})),"Y"==a.isNeedShipping?React.createElement(Grid,{container:!0,direction:"row",justify:"space-between",alignItems:"center"},React.createElement(Typography,{variant:"caption",style:{marginLeft:16,marginTop:16}},"Ongkir"),React.createElement(Typography,{variant:"caption",color:"error",style:{marginRight:16,marginTop:16}},Te(v))):React.createElement(Grid,null),React.createElement(Grid,{container:!0,direction:"row",justify:"space-between",alignItems:"center"},React.createElement(Typography,{variant:"subtitle1",style:{marginLeft:16,marginTop:16}},"Total"),React.createElement(Typography,{variant:"subtitle1",color:"error",style:{marginRight:16,marginTop:16}},Te(v+(ie||[]).map((function(e,t){return e.amount})).reduce((function(e,t){return parseInt(e)+parseInt(t)}),0)))))))),React.createElement(Grid,{item:!0,xs:12,sm:12,md:12,lg:6},React.createElement(Card,{className:e.root},React.createElement(CardContent,null,React.createElement(Typography,{variant:"h6",gutterBottom:!0},"Customer Data"),React.createElement(Grid,{container:!0,spacing:2},Ee({name:"full_name",label:"Nama *",value:(u.payload||{}).full_name}),Ee({name:"phone_number",label:"Nomor Telepon *",value:(u.payload||{}).phone_number}),Ee({name:"email",label:"Email *",option:"area",value:(u.payload||{}).email})),"Y"==a.isNeedShipping?React.createElement(Grid,{container:!0,spacing:2,style:{marginTop:8}},React.createElement(Grid,{item:!0,xs:12,md:6},React.createElement(FormControl,{className:e.formControl,fullWidth:!0},React.createElement(InputLabel,{id:"demo-simple-select-helper-label"},"Provinsi *"),React.createElement(Select,{labelId:"demo-simple-select-helper-label",id:"demo-simple-select-helper",value:N,onChange:function(e){console.log(e),A(e.target.value),fetch("https://market-studio.plink.co.id/api/v1/fetchdata-city?province="+e.target.value.province_id,{method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}}).then((function(e){return e.json()})).then((function(e){U(e.rajaongkir.results)}),(function(e){console.log(JSON.stringify(e))}))}},b.map((function(e){return React.createElement(MenuItem,{key:e.province_id,value:e},e.province)}))),React.createElement(FormHelperText,null,"Pilih provinsi"))),React.createElement(Grid,{item:!0,xs:12,md:6},React.createElement(FormControl,{className:e.formControl,fullWidth:!0},React.createElement(InputLabel,{id:"demo-simple-select-helper-label"},"Kabupaten *"),React.createElement(Select,{labelId:"demo-simple-select-helper-label",id:"demo-simple-select-helper",value:K,onChange:function(e){return function(e){D(e),fetch("https://market-studio.plink.co.id/api/v1/fetchdata-subcity?city="+e.city_id,{method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}}).then((function(e){return e.json()})).then((function(e){console.log("kec:"+JSON.stringify(e)),Q(e.rajaongkir.results)}),(function(e){console.log(JSON.stringify(e))}))}(e.target.value)}},L.map((function(e){return React.createElement(MenuItem,{key:e.city_id,value:e},e.city_name)}))),React.createElement(FormHelperText,null,"Pilih kota"))),React.createElement(Grid,{item:!0,xs:12,md:6},React.createElement(FormControl,{className:e.formControl,fullWidth:!0},React.createElement(InputLabel,{id:"demo-simple-select-helper-label"},"Kecamatan *"),React.createElement(Select,{labelId:"demo-simple-select-helper-label",id:"demo-simple-select-helper",value:F,onChange:function(e){return function(e){B(e)}(e.target.value)}},V.map((function(e){return React.createElement(MenuItem,{key:e.subdistrict_id,value:e},e.subdistrict_name)}))),React.createElement(FormHelperText,null,"Pilih kecamatan"))),Ee({name:"shipping_postal_code",label:"Kode pos",value:"undefined"==u.payload.shipping_postal_code?"":(u.payload||"").shipping_postal_code}),React.createElement(Grid,{item:!0,xs:12,md:6},React.createElement(FormControl,{className:e.formControl,fullWidth:!0},React.createElement(InputLabel,{id:"demo-simple-select-helper-label"},"Kurir *"),React.createElement(Select,{labelId:"demo-simple-select-helper-label",id:"demo-simple-select-helper",value:$,onChange:function(e){return Re(e.target.value)}},React.createElement(MenuItem,{name:"jne",value:"jne"},"JNE"),React.createElement(MenuItem,{name:"pos",value:"pos"},"POS"),React.createElement(MenuItem,{name:"tiki",value:"tiki"},"TIKI")),React.createElement(FormHelperText,null,"Pilih Kurir"))),React.createElement(Grid,{item:!0,xs:12,md:6},React.createElement(FormControl,{className:e.formControl,fullWidth:!0},React.createElement(InputLabel,{id:"demo-simple-select-helper-label"},"Layanan Kurir *"),React.createElement(Select,{labelId:"demo-simple-select-helper-label",id:"demo-simple-select-helper",value:fe,onChange:function(e){T(e.target.value.cost[0].value),Ie(e.target.value)}},(z||[]).map((function(e){return React.createElement(MenuItem,{key:e.service,name:e.service,value:e},e.service)}))),React.createElement(FormHelperText,null,"Pilih Layanan Kurir")))):React.createElement(Grid,null),React.createElement(Grid,{container:!0,spacing:2},Ee({name:"shipping_address",label:"Alamat lengkap *",option:"area",row:4,value:(u.payload||{}).shipping_address}))),React.createElement(CardActions,null,React.createElement(Button,{style:{margin:8},size:"small",variant:"outlined",onClick:function(){window.location.href=TOKOONLINE_PAGE_PRODUCT_CATALOG},className:e.button},"Katalog"),React.createElement(Button,{style:{margin:8},size:"small",variant:"contained",color:"primary",disableElevation:!0,onClick:function(){return e={payload:u.payload},t=e.payload,n='mutation\n            {\n              checkoutProcess(\n                    session_id: "'+localStorage.getItem(TOKOONLINE_TOKOID)+'",\n                    device_id: "xxxx",\n                    full_name: "'+t.full_name+'",\n                    phone_number: "'+t.phone_number+'",\n                    email: "'+t.email+'",\n                    cart_id: '+JSON.stringify(a.listData.map((function(e){return""+e._id})))+',\n                    toko_id: "'+TOKOONLINE_TOKOID+'",\n                    shipping_address: "'+t.shipping_address+'",\n                    shipping_province: "'+(null==N?"":N.province)+'",\n                    shipping_city: "'+(null==K?"":K.city_name)+'",\n                    shipping_subcity: "'+(null==F?"":F.subdistrict_name)+'",\n                    shipping_currier: "'+(null==$?"":$.toUpperCase()+" - "+fe.service)+'",\n                    shipping_postal_code: "'+t.shipping_postal_code+'",\n                    shipping_amount: '+v+"\n                  )\n              {\n                status,\n                error,\n                detail_data\n                {\n                  _id\n                }\n              }\n            }",r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n})},console.log("graphqlData : "+n),void fetch(backendBaseUrl+"/graphql",r).then((function(e){return e.json()})).then((function(e){return console.log("response :"+JSON.stringify(e)),e.errors?alert(JSON.stringify(e.errors)):e.data.checkoutProcess})).then((function(e){if(e){var t=e.error;d({error:t,isRequest:!1,payload:u.payload}),t?alert(t):window.location.href=TOKOONLINE_PAGE_CHECKOUT_CONFIRMATION+"#"+e.detail_data._id}}));var e,t,n,r},className:e.button},"Lanjutkan"))))))}ReactDOM.render(React.createElement(App,null),document.querySelector("#tokoonline_content"));